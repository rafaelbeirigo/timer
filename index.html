<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simple WASM Timer</title>
</head>
<body>
    <h1>Timer: <span id="timerDisplay">0</span></h1>

    <script src="main.js"></script>
    <script>
        // Function to update the DOM display
        function updateTimerDisplay(t) {
            document.getElementById("timerDisplay").innerText = t;
        }

        // Function to get a valid user input
        function getInitialTime() {
            let time;
            while (true) {
                const input = prompt("Enter the number of seconds for the timer:");
                
                // Exit gracefully if user pressed Cancel or Esc
                if (input === null) {
                    console.log("User canceled input. Exiting timer.");
                    return null; // signal cancellation
                }

                time = Number(input);

                // Check if it is a valid positive integer
                if (Number.isInteger(time) && time > 0) {
                    return time;
                } else {
                    alert("Please enter a valid positive integer.");
                }
            }
        }

        // Wait until WASM module is ready
        Module.onRuntimeInitialized = () => {
            let current_time = getInitialTime();

            // If user canceled, do not start timer
            if (current_time === null) return;

            updateTimerDisplay(current_time);

            // Start ticking every second
            const interval = setInterval(() => {
                current_time = Module._next_time(current_time);
                updateTimerDisplay(current_time);

                if (current_time === 0) {
                    clearInterval(interval);
                    console.log("Timer finished!");
                }
            }, 1000);
        };
    </script>
</body>
</html>
